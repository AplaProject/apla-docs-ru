################################################################################
REST API v2
################################################################################
Все функции, доступные в программном клиенте Molis, включая аутентификацию, получение данных об экосистемах, обработку ошибок, оперирование с таблицами базы данных, страницами интерфейсов, запуск контрактов (транзакций сети) доступны через REST API платформы. Таким образом, благодаря REST API разработчики могут получить доступ ко всему функционалу платформы без использования программного  клиента Molis.

Вызов команды происходит при обращении к ``/api/v2/command/[param]``, где **command** - имя команды, **param** - дополнительный параметр, например, имя изменяемого или получаемого ресурса. Отправлять параметры запросов следует с ``Content-Type: x-www-form-urlencoded``. Ответ сервера представлен в JSON формате.

********************************************************************************
Обработка ошибок
********************************************************************************

В случае успешного выполнения запроса возвращается статус 200. В случае ошибки, кроме ошибочного статуса возвращается объект JSON c полями:

* **error** - идентификатор ошибки,
* **msg** - текст ошибки,
* **params** - массив дополнительных параметров ошибки, которые могут быть подставлены в сообщение об ошибке.

Пример ответа

.. code:: 

    400 (Bad Request)
    Content-Type: application/json
    {
        "err": "E_INVALIDWALLET",
        "msg": "Wallet 1111-2222-3333 is not valid",
        "params": ["1111-2222-3333"]
    }

Список ошибок

* **E_CONTRACT** - There is not %s contract,
* **E_DBNIL** - DB is nil,
* **E_ECOSYSTEM** - Ecosystem %d doesn't exist,
* **E_EMPTYPUBLIC** - Public key is undefined,
* **E_EMPTYSIGN** - Signature is undefined,
* **E_HASHWRONG** - Hash is incorrect,
* **E_HASHNOTFOUND** - Hash has not been found,
* **E_HEAVYPAGE** - This page is heavy,
* **E_INSTALLED** - platform is already installed,
* **E_INVALIDWALLET** - Wallet %s is not valid,
* **E_NOTFOUND** - Content page or menu has not been found,
* **E_NOTINSTALLED** - platform is not installed. В этом случае нужно запустить установку командно *install*,
* **E_QUERY** - DB query is wrong,
* **E_RECOVERED** - API recovered, возвращается в случае panic error,
* **E_REFRESHTOKEN** - Refresh token is not valid,
* **E_SERVER** - Server error. Возвращается в случае ошибки в библиотечных функциях golang; поле *msg* содержит текст ошибки,
* **E_SIGNATURE** - Signature is incorrect,
* **E_STATELOGIN** - %s is not a membership of ecosystem %s,
* **E_TABLENOTFOUND** - Table %s has not been found,
* **E_TOKEN** - Token is not valid,
* **E_TOKENEXPIRED** - Token is expired by %s,
* **E_UNAUTHORIZED** - Unauthorized,
* **E_UNDEFINEVAL** - Value %s is undefined,
* **E_UNKNOWNUID** - Unknown uid,
* **E_VDE** - Virtual Dedicated Ecosystem %s doesn't exist,
* **E_VDECREATED** - Virtual Dedicated Ecosystem is already created.


Если, неважно где, возвращается ошибка **E_RECOVERED**, то это баг, который требует обнаружения и исправления. Ошибка **E_NOTINSTALLED** должна возвращаться любой командой кроме *install*, в случае, если система еще не установлена. Ошибка **E_SERVER** теоретически может возвратится в любой команде. Если она возникает на неверных входных параметрах, то её можно заменить на соответствующие ошибки. В противном случае, это ошибка сообщает о неверном функционировании или настройке системы, то есть требует более детального изучения. Ошибка **E_UNAUTHORIZED** может возвращаться на любой команде кроме *install, getuid, login* в случае, если не был осуществлен login или сессия закончилась.

********************************************************************************
Аутентификация
********************************************************************************

Для аутентификации используется **JWT токен** http://www.jwt.org. После получения JWT токена необхоимо передавать его при каждом запросе в заголовке: ``Authorization: Bearer TOKEN_HERE``. 

getuid
==============================
**GET**/ Возвращает уникальное значение, которое нужно подписать своим приватным ключом и отправить обратно серверу с помощью команды **login**. На данный момент создается временный JWT токен, который нужно передать в **Authorization** при вызове **login**.

.. code:: 
    
    GET
    /api/v2/getuid
    
Ответ

* *uid* - строка для подписи.
* *token* - временный токен для передачи в login. Время жиззни временного токена сейчсас составляет 5 секунд.

В случае, когда авторизация не требуется, то возвращаются

* *expire* - количество секунд до истечения срока,
* *ecosystem* - идентификатор экосистемы,
* *key_id* - идентификатор  кошелька,
* *address* - адрес кошелька в формате ``XXXX-XXXX-.....-XXXX``.
    
Вариант ответа

.. code:: 
    
    200 (OK)
    Content-Type: application/json
    {
        "uid": "28726874268427424",
        "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6I........AU3yPRp64SLO4aJqhN-kMoU5HNYTDplQXbVu0Y"
    }
    
Ошибки: *E_SERVER*   

login
==============================
**POST**/ Аутентификация пользователя. Предварительно необходимо вызвать команду **getuid** для получения уникального значения и подписать его. В заголовке нужно передать временный JWT токен полученный вместе с getuid. В случае успешного завершения нужно полученный в ответе токен передавать во всех запросах в заголовке *Authorization*.

Запрос

.. code:: 

    POST
    /api/v2/login
    
* *[ecosystem]* - идентификатор экосистемы. Если не указан, то берется первая экосистема,
* *[expire]* - время длительности JWT токена в секундах, по умолчанию - 36000,
* *[pubkey]* - публичный ключ hex; если в блокчейне уже есть хранится ключ, то нужно передать идентификатор аккаунта в любом виде в параметре *key_id*,
* *[key_id]* - идентификатор аккаунта в виде числа или ``XXXX-...-XXXX``; использовать, если публичный ключ уже хранится в блокчейне; нельзя указывать совместно с *pubkey*,
* *signature* - подпись uid полученного через getuid hex.

Ответ

* *token* - JWT токен,
* *refresh* - JWT токен для продления сессии. Необходимо передавать в команду **refresh**,
* *ecosystem* - идентификатор экосистемы,
* *key_id* - идентификатор  аккаунта,
* *address* - адрес аккаунта в формате ``XXXX-XXXX-.....-XXXX``,
* *notify_key* - ключ для получения уведомлений,
* *isnode* - true или false - является ли владельцем данной ноды,
* *isowner* - true или false - является ли владельцем данной экосистемы,
* *vde* - true или false - есть ли у экосистемы virtual dedicated ecosystem.

Вариант ответа

.. code:: 
    
    200 (OK)
    Content-Type: application/json
    {
        "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6I........AU3yPRp64SLO4aJqhN-kMoU5HNYT8fNGODp0Y"
        "refresh": "eyJhbGciOiJIUzI1NiIsInR5cCI6I........iOiI1Nzk3ODE3NjYwNDM2ODA5MzQ2Iiw"        
        "ecosystem":"1",
        "key_id":"12345",
        "address": "1234-....-3424"
    }      

Ошибки: *E_SERVER, E_UNKNOWNUID, E_SIGNATURE, E_STATELOGIN, E_EMPTYPUBLIC* 

refresh
==============================
**POST**/ Команда выдает новые токены и продляет сессию пользователя. В случае успешного завершения нужно полученный в ответе токен передавать во всех запросах в заголовке *Authorization*.

Запрос

.. code:: 

    POST
    /api/v2/refresh
    
* *[expire]* - время длительности JWT токена в секундах. По умолчанию, 36000.
* *token* - токен обновления из предыдущего вызова **login** или **refresh**.

Ответ

* *token* - JWT токен.
* *refresh* - JWT токен для продления сессии. Необходимо передавать в команду **refresh**.

Вариант ответа

.. code:: 
    
    200 (OK)
    Content-Type: application/json
    {
        "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6I........AU3yPRp64SLO4aJqhN-kMoU5HNYT8fNGODplQXbVu0Y"
        "refresh": "eyJhbGciOiJIUzI1NiIsInR5cCI6I........iOiI1Nzk3ODE3NjYwNDM2ODA5MzQ2Iiw"        
    }      

Ошибки: *E_SERVER, E_TOKEN, E_REFRESHTOKEN* 

signtest
==============================
**POST**/ Команда подписывает строку указанным приватным ключом. Должна использоваться исключительно для тестирования API, так как в реальной работе приватный ключ не должен передаваться на сервер. Приватный ключ можно взять из директории где запускается сервер. Если подпись формируется для последующей передачи в /login, необходимо передать вместо forsign строку LOGINforsign.

.. code:: 
    
    POST
    /api/v2/signtest
 
* *private* - hex приватный ключ,
* *forsign* - строка для подписи.

Ответ

* *signature* - подпись в шестнадцатеричном виде,
* *pubkey* - публичный ключ для переданного приватного ключа hex.
    
Вариант ответа

.. code:: 
    
    200 (OK)
    Content-Type: application/json
    {
        "signature": "0011fa...",
        "pubkey": "324bd7..."
    }      

Ошибки: *E_SERVER* 

********************************************************************************
Служебные команды
********************************************************************************

install
==============================
**POST**/ Команда производит установку системы. После успешной установки систему требуется перезапустить. 

Запрос

.. code:: 

    POST
    /api/v2/install
 
* *type* - тип установки: **PRIVATE_NET, TESTNET_NODE, TESTNET_URL**,
* *log_level* - уровень логгирования: **ERROR, DEBUG**,
* *first_load_blockchain_url* - адрес для получения блокчейна; указывается в случае *type* равным *TESTNET_URL*,
* *db_host* - хост для БД PostgreSQL. Например, *localhost*,
* *db_port* - порт для БД PostgreSQL. Например, *5432*,
* *db_name* - имя БД PostgreSQL. Например, *mydb*,
* *db_user* - имя пользователя для подключения к БД PostgreSQL, например, *postgres*,
* *db_pass* - пароль для подключения к БД PostgreSQL, например, *postgres*,
* *generate_first_block* - Может быть равен 0 или 1 когда *type* равен *Private-net*, 
* *first_block_dir* - директория где хранится файл *1block* с первым блоком; указывается когда *generate_first_block* равен 0     и *type* равен *PRIVATE_NET*.

Ответ

* *success* - true в случае успешного завершения.

Вариант ответа

.. code:: 
    
    200 (OK)
    Content-Type: application/json
    {
        "success": true
    }      

Ошибки: *E_SERVER, E_INSTALLED, E_DBNIL*

version
==============================
**GET**/ Возвращает текущую версию сервера.

Запрос

.. code:: 

    GET
    /api/v2/version

Вариант ответа

.. code:: 
    
    200 (OK)
    Content-Type: application/json
    "0.1.6"

********************************************************************************
Функции получения данных
********************************************************************************

balance
==============================
**GET**/ Возвращает баланс указанного аккаунта в текущей экосистеме. 

Запрос

.. code:: 
    
    GET
    /api/v2/balance/{key_id}
    
* *key_id* - идентификатор аккаунта, может быть представлен в любом формате - ``int64, uint64, XXXX-...-XXXX``; поиск указанного аккаунта осуществляется в экосистеме, в которую вошел пользователь.   
    
Ответ    

* *amount* - cумма на аккаунте в минимальных единицах,
* *money* - cумма на аккаунте в единицах.
    
Вариант ответа

.. code:: 
    
    200 (OK)
    Content-Type: application/json
    {
        "amount": "123450000000000000000",
        "money": "123.45"
    }      

Ошибки: *E_SERVER, E_INVALIDWALLET* 

********************************************************************************
Работа с экосистемами
********************************************************************************

ecosystems
==============================
**GET**/ Возвращает количество экосистем.

.. code:: 
    
    GET
    /api/v2/ecosystems/

Ответ

* *number* - количество установленных экосистем.
    
Вариант ответа

.. code:: 
    
    200 (OK)
    Content-Type: application/json
    {
        "number": 100,
    }      

Ошибки: *E_SERVER* 

vde/create
==============================
**POST**/ Создает Virtal Dedicated Ecosystem (VDE) для текущей экосистемы.

.. code:: 
    
    POST
    /api/v2/vde/create

Ответ

* *result* - возвращает *true*, если VDE успешно создалась.
    
Вариант ответа

.. code:: 
    
    200 (OK)
    Content-Type: application/json
    {
        "result": true,
    }     
    
Ошибки: *E_VDECREATED, E_PERMISSION, E_SERVER*

appparams
==============================
**GET**/ Возвращает список параметров приложения в текущей или указанной экосистеме.

Запрос

.. code:: 
    
    GET
    /api/v2/appparams/{appid}[?ecosystem=...&names=...]

* *[appid]* - идентификатор приложения,
* *[ecosystem]* - идентификатор экосистемы; если не указан, то будут возвращены параметры текущей экосистемы,
* *[names]* - список получаемых параметров; при желании можно указать через запятую список имен получаемых параметров, например, ``/api/v2/appparams/1?names=name,mypar``.

Ответ 

* *list* - массив, каждый элемент которого содержит следующие параметры.

  * *name* - наименование параметра,
  * *value* - значение параметра,
  * *conditions* - права на изменение параметра.

Вариант ответа

.. code:: 
    
    200 (OK)
    Content-Type: application/json
    {
        "list": [{ 
            "name": "name",
            "value": "MyState",
            "conditions": "true",
        }, 
        { 
            "name": "mypar",
            "value": "My value",
            "conditions": "true",
        }, 
        ]
    }      

Ошибки: *E_ECOSYSTEM*

appparam/{appid}/{name}
==============================
**GET**/ Возвращает информацию о параметре приложения c идентификатор **{appid}** и с именем **{name}** в текущей или указанной экосистеме. 

Запрос

.. code:: 
    
    GET
    /api/v2/{appid}/{appid}/{name}[?ecosystem=1]
    
* *appid* - идентификатор приложения,
* *name* - имя запрашиваемого параметра,
* *[ecosystem]* - можно указать идентификатор экосистемы. По умолчанию, возвратится значение текущей экосистемы.

Ответ
    
* *id* - идентификатор параметра,
* *name* - наименование параметра,
* *value* - значение параметра,
* *conditions* - условие изменения параметра.
    
Вариант ответа

.. code:: 
    
    200 (OK)
    Content-Type: application/json
    {
        "id": "10",
        "name": "par",
        "value": "My value",
        "conditions": "true"
    }      

Ошибки: *E_ECOSYSTEM*


ecosystemparams
==============================
**GET**/ Возвращает список параметров экосистемы.

Запрос

.. code:: 
    
    GET
    /api/v2/ecosystemparams/[?ecosystem=...&names=...]

* *[ecosystem]* - идентификатор экосистемы; если не указан, то будут возвращены параметры текущей экосистемы,
* *[names]* - список получаемых параметров; при желании можно указать через запятую список имен получаемых параметров, например, ``/api/v2/ecosystemparams/?names=name,currency,logo``.
* *[vde]* - укажите ``true``, если необходимо получить параметры VDE, в противном случае, этот параметр указывать не нужно.


Ответ 

* *list* - массив, каждый элемент которого содержит следующие параметры.

  * *name* - наименование параметра,
  * *value* - значение параметра,
  * *conditions* - права на изменение параметра.

Вариант ответа

.. code:: 
    
    200 (OK)
    Content-Type: application/json
    {
        "list": [{ 
            "name": "name",
            "value": "MyState",
            "conditions": "true",
        }, 
        { 
            "name": "currency",
            "value": "MY",
            "conditions": "true",
        }, 
        ]
    }      

Ошибки: *E_ECOSYSTEM,E_VDE*

ecosystemparam/{name}
==============================
**GET**/ Возвращает информацию о параметре с именем **{name}** в текущей или указанной экосистеме. 

Запрос

.. code:: 
    
    GET
    /api/v2/ecosystemparam/{name}[?ecosystem=1]
    
* *name* - имя запрашиваемого параметра,
* *[ecosystem]* - можно указать идентификатор экосистемы. По умолчанию, возвратится значение текущей экосистемы,
* *[vde]* - укажите ``true``, если необходимо получить параметр из VDE, в противном случае, этот параметр указывать не нужно.

Ответ
    
* *name* - наименование параметра,
* *value* - значение параметра,
* *conditions* - условие изменения параметра.
    
Вариант ответа

.. code:: 
    
    200 (OK)
    Content-Type: application/json
    {
        "name": "currency",
        "value": "MYCUR",
        "conditions": "true"
    }      

Ошибки: *E_ECOSYSTEM,E_VDE*
    
tables/[?limit=...&offset=...]
==============================
**GET**/ Возвращает список таблиц в текущей экосистеме. Можно указать смещение и количество запрашиваемых таблицы. 

Запрос

* *[limit]* - количество записей, по умолчанию - 25,
* *[offset]* - смещение начала записей, по умолчанию - 0,
* *[vde]* - укажите *true*, если необходимо получить список таблиц в VDE, в противном случае, этот параметр указывать не нужно.

.. code:: 
    
    GET
    /api/v2/tables

Ответ

* *count* - общее количество записей в таблице,
* *list* - массив, каждый элемент которого содержит следующие параметры:

  * *name* - имя таблицы, возвращается без префикса,
  * *count* - количество записей в таблице.

Вариант ответа

.. code:: 
    
    200 (OK)
    Content-Type: application/json
    {
        "count": "100"
        "list": [{ 
            "name": "accounts",
            "count": "10",
        }, 
        { 
            "name": "citizens",
            "count": "5",
       }, 
        ]
    }    

Ошибки: *E_VDE*    

table/{name}
==============================
**GET**/ Возвращает информацию о таблице с указанным именем в текущей экосистеме.

Возвращаются следующие поля: 
* *name* - имя таблицы, 
* *insert* - права на вставку элементов, 
* *new_column* - права на добавление клонки, 
* *update* - права на изменене прав, 
* *columns* - массив колонок с полями ``name, type, perm`` - имя, тип, права на изменение.

Запрос

.. code:: 
    
    GET
    /api/v2/table/mytable
    
* *name* - имя таблицы (без префикса-идентифкатора экосистемы),
* *[vde]* - укажите *true*, если необходимо получить информацию о таблице VDE, в противном случае, этот параметр указывать не нужно.

Ответ

* *name* - имя таблицы (без префикса-идентифкатора экосистемы),
* *insert* - право на добавление записей,
* *new_column* - право на добавление колонки,
* *update* - право на изменение записей,
* *conditions* - право на изменение настроек таблицы,
* *columns* - массив информации о колонках:

  * *name* - имя столбца,
  * *type* - тип колонки; dозможны следующие значения: ``varchar, bytea, number, money, text, double, character``,
  * *perm* - права на изменение записе в столбце.
    
Вариант ответа

.. code:: 
    
    200 (OK)
    Content-Type: application/json
    {
        "name": "mytable",
        "insert": "ContractConditions(`MainCondition`)",
        "new_column": "ContractConditions(`MainCondition`)",
        "update": "ContractConditions(`MainCondition`)",
        "conditions": "ContractConditions(`MainCondition`)",
        "columns": [{"name": "mynum", "type": "number", "perm":"ContractConditions(`MainCondition`)" }, 
            {"name": "mytext", "type": "text", "perm":"ContractConditions(`MainCondition`)" }
        ]
    }      
    
Ошибки: *E_TABLENOTFOUND,E_VDE*    
    
list/{name}[?limit=...&offset=...&columns=]
==============================
**GET**/ Возвращает список записей указанной таблицы в текущей экосистеме. Можно указать смещение и количество запрашиваемых элементов таблицы. 

Запрос

* *name* - имя таблицы,
* *[limit]* - количество записей, по умолчанию - 25,
* *[offset]* - смещение начала записей, по умолчанию - 0,
* *[columns]* - список запрашиваемых колонок через запятую; если не указано, то будут возвращены все колонки; колонка id возвращается в любом случае,
* *[vde]* - укажите *true*, если необходимо получить записи из таблицы в VDE, в противном случае, этот параметр указывать не нужно.

.. code:: 
    
    GET
    /api/v2/list/mytable?columns=name

Ответ

* *count* - общее количество записей в таблице,
* *list* - массив, каждый элемент которого содержит следующие параметры:

  * *id* - идентификатор записи,
  * *columns* - последовательность запрошенных колонок. 

Вариант ответа

.. code:: 
    
    200 (OK)
    Content-Type: application/json
    {
        "count": "10"
        "list": [{ 
            "id": "1",
            "name": "John",
        }, 
        { 
            "id": "2",
            "name": "Mark",
       }, 
        ]
    }   

Ошибки: *E_TABLENOTFOUND,E_VDE*    

row/{tablename}/{id}[?columns=]
==============================
**GET**/ Возвращает запись таблицы с указанным id в текущей экосистеме. Можно указать возвращаемые колонки. 

Запрос

* *tablename* - имя таблицы,
* *id* - идентификатор записи,
* *[columns]* - список запрашиваемых колонок через запятую, если не указано, то будут возвращены все колонки; колонка id возвращается в любом случае,
* *[vde]* - укажите *true*, если необходимо получить запись из таблицы в VDE, в противном случае, этот параметр указывать не нужно.

.. code:: 
    
    GET
    /api/v2/row/mytable/10?columns=name

Ответ

* *value* - массив полученных значений колонок:

  * *id* - идентификатор записи,
  * последовательность запрошенных колонок. 

Вариант ответа

.. code:: 
    
    200 (OK)
    Content-Type: application/json
    {
        "values": {
        "id": "10",
        "name": "John",
        }
    }   

Ошибки: *E_QUERY*    

systemparams
==============================
**GET**/  Возвращает список системных параметров.

Запрос

.. code:: 
    
    GET
    /api/v2/systemparams/[?names=...]

* *[names]* - список получаемых параметров; при желании можно указать через запятую список имен получаемых параметров, например, ``/api/v2/systemparams/?names=max_columns,max_indexes``.

Ответ 

* *list* - массив, каждый элемент которого содержит следующие параметры:

  * *name* - наименование параметра,
  * *value* - значение параметра,
  * *conditions* - права на изменение параметра.

Вариант ответа

.. code:: 
    
    200 (OK)
    Content-Type: application/json
    {
        "list": [{ 
            "name": "max_columns",
            "value": "100",
            "conditions": "ContractAccess("@0UpdSysParam")",
        }, 
        { 
            "name": "max_indexes",
            "value": "1",
            "conditions": "ContractAccess("@0UpdSysParam")",
        }, 
        ]
    }      

history/{name}/{id}
==============================
**GET**/ Возвращает историю изменения записи указанной таблицы в текущей экосистеме. 

Запрос

* *name* - имя таблицы,
* *id* - идентификатор записи.

.. code:: 
    
    GET
    /api/v2/history/pages/1

Ответ

* *list* - массив, каждый элемент которого содержит измененные параметры для запрашиваемой записи

Вариант ответа

.. code:: 
    
    200 (OK)
    Content-Type: application/json
    {
        "list": [
            {
                "name": "default_page",
                "value": "P(class, Default Ecosystem Page)"
            },
            {
                "menu": "default_menu"
            }
        ]
    }
    
interface/{page|menu|block}/{name}
==================================

**GET**/ Возвращает запись таблицы page, menu или block с указанным name в текущей экосистеме.

Запрос

* *name* - название записи в указанной таблице,
* *[vde]* - укажите *true*, если необходимо получить запись из таблицы в VDE, в противном случае, этот параметр указывать не нужно.

.. code:: 
    
    GET
    /api/v2/interface/page/default_page

Ответ

* *id* - идентификатор записи,
* *name* - название записи,
* другие колонки таблицы. 

Вариант ответа

.. code:: 
    
    200 (OK)
    Content-Type: application/json
    {
        "id": "1",
        "name": "default_page",
	"value": "P(Page content)",
	"default_menu": "default_menu",
	"validate_count": 1
    }   

Ошибки: *E_QUERY*, *E_NOTFOUND* 

********************************************************************************
Функции работы с контрактами
********************************************************************************

contracts[?limit=...&offset=...]
==============================
**GET**/ Возвращает список контрактов в текущей экосистеме. Можно указать смещение и количество запрашиваемых контрактов. 

Запрос

* *[limit]* - количество записей, по умолчанию - 25,
* *[offset]* - смещение начала записей, по умолчанию - 06,
* *[vde]* - укажите *true*, если необходимо получить список контрактов из VDE, в противном случае, этот параметр указывать не нужно.

.. code:: 
    
    GET
    /api/v2/contracts

Ответ

* *count* - общее количество записей в таблице,
* *list* - массив, каждый элемент которого содержит следующие параметры:

  * *id* - идентификатор записи,
  * *name* - имя контракта,
  * *value* - исходный текст контракта,
  * *active* - равно "1", если контракт привязан к аккаунту, и "0" в противном случае,
  * *key_id* - аккаунт привязанный к контракту,
  * *address* - адрес аккаунта привязанного к контракту в формате ``XXXX-...-XXXX``. 
  * *conditions* - права на изменение контракта,
  * *token_id* - экосистема, в токенах которой оплачивается контракт.

Вариант ответа

.. code:: 
    
    200 (OK)
    Content-Type: application/json
    {
        "count": "10"
        "list": [{ 
            "id": "1",
            "name": "MainCondition",
            "token_id":"1", 
            "key_id":"2061870654370469385", 
            "active":"0",
            "value":"contract MainCondition {
  conditions {
      if(StateVal(`founder_account`)!=$citizen)
      {
          warning `Sorry, you dont have access to this action.`
        }
      }
    }",
    "address":"0206-1870-6543-7046-9385",
    "conditions":"ContractConditions(`MainCondition`)"        
     }, 
    ...
      ]
    }   


contract/{name}
==============================
**GET**/ Возвращает информацию о смарт конракте с именем **{name}**. По умолчанию, смарт контракт ищется в текущей экосистеме.

Запрос

* *name* - имя смарт контракта,
* *[vde]* - укажите *true*, если необходимо получить информацию о контракте из VDE, в противном случае, этот параметр указывать не нужно.

.. code:: 
    
    GET
    /api/v2/contract/mycontract

Ответ

* *name* - имя смарт контракта с идентификатором экосистемы, например, ``@{idecosystem}name``.
* *active* - true если контракт привязан к аккаунту и false в противном случае,
* *key_id* - идентификатор владельца контракта,
* *address* - адрес аккаунта привязанного к контракту в формате ``XXXX-...-XXXX``,
* *tableid* - идентификатор записи в таблице contracts, где хранится исходный код контракта,
* *fields* -  массив, содержащий информацию о каждом параметре в разделе **data** контракта и содержит поля:

  * *name* - имя поля,
  * *htmltype* - html тип,
  * *type* - тип парметра,
  * *tags* - тэги параметра.
    
Вариант ответа

.. code:: 
    
    200 (OK)
    Content-Type: application/json
    {
        "fields" : [
            {"name":"amount", "htmltype":"textinput", "type":"int64", "tags": "optional"},
            {"name":"name", "htmltype":"textinput", "type":"string" "tags": ""}
        ],
        "name": "@1mycontract",
        "tableid" : 10,
        "active": true
    }      

contract/{request_id}
==============================
**POST**/ Вызывает смарт-контракт по идентификатору запроса **{request_id}**. Предварительно нужно вызывать команду ``prepare/{name}`` (POST) и подписывать возвращаемое поле *forsign*. Запрос с идентификатором **{request_id}** хранится на сервере 1 минуту, если за это время не выполнить contract, то запрос будет удален. В случае успешного выполнения возвращается хэш транзакции, c помощью которого можно получить номер блока в случае успешного выполнения или текст ошибки.

Запрос

* *request_id* - идентификатор запроса, который получен из prepare,
* *[token_ecosystem]* - для непривязанных контрактов можно указать валютой какой экосистемы будет оплачен контракт, в этом случае аккаунт и публичный ключ *token_ecosystem* и текущей экосистемы должны совпадать,
* *[max_sum]* - при вызове непривязанных к аккаунту контрактов можно указать максимальную сумму, которую согласны потратить на выполнение данного контракта,
* *[payover]* - для непривязанных к аккаунту контрактов можно указать надбавку за срочность - сколько добавить к fuel_rate при вычислении оплаты,
* передаваемые контракту параметры,
* *signature* - hex подпись значения *forsign*, которое получено из prepare,
* *time* - время, возвращенное prepare,
* *pubkey* - hex публичный ключ подписавшего контракт; следует заметить, что если публичный ключ уже хранится в таблице keys данной экосистемы, то его можно не передавать,
* *[vde]* - укажите *true*, если вы вызываете смарт-контракт из VDE, в противном случае, этот параметр указывать не нужно.

.. code:: 
 
    POST
    /api/v2/contract/5c273816-134e-4a50-89b2-8d2b3d5ba562
    signature - hex подпись
    time - время, возвращенное prepare

Ответ

* *hash* - hex хэш отправленной транзакции.

Вариант ответа

.. code:: 

    200 (OK)
    Content-Type: application/json
    {
        "hash" : "67afbc435634.....",
    }

Ошибки: *E_CONTRACT, E_EMPTYPUBLIC, E_EMPTYSIGN, E_NOTFOUNDREQUEST*


prepare/{name}
==============================
**POST**/ Отправляет запрос на получение строки для подписи указанного контракта. В качестве **{name}** необходимо указать имя транзакции для которой следует возвратить строку для подписи. В параметре forsign возвращается строка, которую необходимо будет подписать. Также возвращается параметры request_id и time, которые нужно будет передать вместе с подписью.

Запрос

* *name* - имя контракта, если вызывается контракт из другой экосистемы, то необходимо указывать полное имя (``@1MainContract``).
* *[token_ecosystem]* - для контрактов не привязанных к аккаунту можно указать в токенах какой экосистемы будет оплачен контракт, в этом случае аккаунт и публичный ключ *token_ecosystem* и текущей экосистемы должны совпадать,
* *[max_sum]* - при вызове непривязанных контрактов можно указать максимальную сумму, которую согласны потратить на выполнение данного контракта,
* *[payover]* - для непривязанных контрактов можно указать надбавку за срочность - сколько добавить к fuel_rate при вычислении оплаты,
* *[vde]* - укажите *true*, если вы будете вызывать смарт-контракт из VDE, в противном случае, этот параметр указывать не нужно.
* передаваемые контракту параметры.

.. code:: 
    
    POST
    /api/v2/prepare/mycontract

Ответ

* *request_id* - идентификатор запроса, который нужно передать,
* *forsign* - строка для подписи,
* *time* - время, которое нужно будет передать вместе с контрактом.

Вариант ответа

.. code:: 
    
    200 (OK)
    Content-Type: application/json
    {
        "request_id": "5c273816-134e-4a50-89b2-8d2b3d5ba562",
        "time": 423523768,
        "forsign": "......", 
    }


Ошибки: *E_CONTRACT*
    
txstatus/{hash}
==============================
**GET**/ Возвращает номер блока или ошибку отправленной транзакции с данным хэшем. Если возвращаемые значения *blockid* и *errmsg* пустые, значит транзакция еще не была запечатана в блок.

Запрос

* *hash* - хэш проверяемой транзакции.

.. code:: 
    
    GET
    /api/v2/txstatus/2353467abcd7436ef47438
    
Ответ

* *blockid* - номер блока, в случае успешной обработки транзакции,
* *result* - результат работы транзакции, возвращаемый через переменную **$result**,
* *errmsg* - текст ошибки, в случае отклонения транзакции.
    
Вариант ответа

.. code:: 
    
    200 (OK)
    Content-Type: application/json
    {
        "blockid": "4235237",
        "result": ""
    }      

Ошибки: *E_HASHWRONG, E_HASHNOTFOUND*
    

content/{menu|page}/{name}
==============================
**POST**/ Возвращает JSON представление кода указанной страницы или меню с именем **{name}**, которое получается после обработки шаблонизатором. При запросе можно передавать дополнительные параметры, которые можно использовать в шаблонизаторе. Если страница или меню не найдены, то возвращается ошибка 404.

Запрос

* *menu|page* - *page* или *menu* для получения страницы или меню соответственно,
* *name* - имя получаемой страницы или меню,
* *[lang]* - можно указать двухбуквенный код языка или lcid, для подключения соответствующих языковых ресурсов. Например, *en,ru,fr,en-US,en-GB*. Если, например, не будет найден ресурс для *en-US*, то он будет искаться для *en*.
* *[vde]* - *true*, если страница или меню получаются в VDE, в противном случае, этот параметр указывать не нужно.

.. code:: 
    
    POST
    /api/v2/content/page/default

Ответ

* *menu* - имя меню для страницы при вызове *content/page/...*,
* *menutree* - JSON дерево меню для страницы при вызове *content/page/...*,
* *title* - заголовок для меню *content/menu/...*,
* *tree* - JSON дерево объектов.

Вариант ответа

.. code:: 
    
    200 (OK)
    Content-Type: application/json
    {
        "tree": {"type":"......", 
              "children": [
                   {...},
                   {...}
              ]
        },
    }      

Ошибки: *E_NOTFOUND, E_SERVER, E_HEAVYPAGE*

content/source/{name}
==============================
**POST**/ Возвращает JSON представление кода указанной страницы с именем **{name}** без выполнения функций и получения данных. Возвращаемое дерево соответствует шаблону страницы и может быть использовано в визуальном конструкторе. Если страница или меню не найдены, то возвращается ошибка 404.

Запрос

* *name* - имя получаемой страницы,
* *[vde]* - *true*, если страница или меню получаются в VDE, в противном случае, этот параметр указывать не нужно.

.. code:: 
    
    POST
    /api/v2/content/source/default

Ответ

* *tree* - JSON дерево объектов.

Вариант ответа

.. code:: 
    
    200 (OK)
    Content-Type: application/json
    {
        "tree": {"type":"......", 
              "children": [
                   {...},
                   {...}
              ]
        },
    }      

Ошибки: *E_NOTFOUND, E_SERVER*

content
==============================
**POST**/ Возвращает JSON представление кода указанного в параметре **template**. Если указан дополнительный параметр **source** равный *true* или *1*, то возвратится JSON представление без выполнения функций и получения данных. Возвращаемое дерево соответствует переданному шаблону и может быть использовано в визуальном конструкторе. 

Запрос

* *template* - текст шаблона страницы для разбора,
* *[source]* - если равен *true* или *1*, то дерево возвратится без выполнения функций и получения данных.

.. code:: 
    
    POST
    /api/v2/content

Ответ

* *tree* - JSON дерево объектов.

Вариант ответа

.. code:: 
    
    200 (OK)
    Content-Type: application/json
    {
        "tree": {"type":"......", 
              "children": [
                   {...},
                   {...}
              ]
        },
    }      

Ошибки: *E_NOTFOUND, E_SERVER*

node/{name}
==============================
**POST**/ Вызвает смарт-контракт с указанным именем **{name}** от имени ноды. Используется для вызова смарт контрактов из VDE контрактов через функцию **HTTPRequest**. Так как в этом случае мы не можем подписать контракт, то контракт будет подписан приватным ключом ноды. Все остальные параметры, такие же как при отправке контракта. Также нужно учитывать, чтобы вызываемый контракт был привязан к аккаунту. В противном случае, на счету у приватного ключа ноды нет средств на выполнение контракта. Если вызов происходит из vde контракта, то необходимо передать в **HTTPRequest** токен авторизации **$auth_token**.

.. code:: js

	var pars, heads map
	heads["Authorization"] = "Bearer " + $auth_token
	pars["vde"] = "false"
	ret = HTTPRequest("http://localhost:7079/api/v2/node/mycontract", "POST", heads, pars)

Запрос

.. code:: 
 
    POST
    /api/v2/node/mycontract

Ответ

* *hash* - hex хэш отправленной транзакции.

Вариант ответа

.. code:: 

    200 (OK)
    Content-Type: application/json
    {
        "hash" : "67afbc435634.....",
    }

Ошибки: *E_CONTRACT, E_EMPTYPUBLIC, E_EMPTYSIGN*


maxblockid
==============================
**GET**/ Возвращает максимальный id блока на текущей ноде. 

Запрос

.. code:: 
 
    GET
    /api/v2/maxblockid

Ответ

* *max_block_id* - максимальный id блока на текущей ноде.

Вариант ответа

.. code:: 

    200 (OK)
    Content-Type: application/json
    {
        "max_block_id" : 341,
    }

Ошибки: *E_NOTFOUND*

block/{id}
==============================
**GET**/ Возвращает информацию о блоке с указанным ID.

Запрос

* *id* - id запрашиваемого блока.

.. code:: 
    
    POST
    /api/v2/block/32

Ответ

* *hash* - хэш блока.
* *ecosystem_id* - id экосистемы.
* *key_id* - каким ключом был подписан блок.
* *time* - timestamp генерации блока.
* *tx_count* - количество транзакции в блоке.
* *rollbacks_hash* - хэш роллбеков, созданных транзакциями блока.


Вариант ответа

.. code:: 
    
    200 (OK)
    Content-Type: application/json
    {
        "hash": "\x1214451d1144a51",
        "ecosystem_id": 1,
        "key_id": -13646477,
        "time": 134415251,
        "tx_count": 3,
        "rollbacks_hash": "\xa1234b1234"
    }      

Ошибки: *E_NOTFOUND*
